# Development Dockerfile for Docker Neural Memory
# Includes uv, development tools, and hot-reload support

FROM python:3.11-slim

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    git \
    && rm -rf /var/lib/apt/lists/*

# Install uv - fast Python package manager
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.local/bin:$PATH"

WORKDIR /app

# Copy ALL project files for installation
COPY pyproject.toml .
COPY src/ ./src/
COPY tests/ ./tests/

# Create virtual environment with uv and install dependencies
RUN uv venv && \
    . .venv/bin/activate && \
    uv pip install -e ".[dev]"

# Set up environment
ENV VIRTUAL_ENV=/app/.venv
ENV PATH="$VIRTUAL_ENV/bin:$PATH"
ENV PYTHONPATH=/app

# Default configuration
ENV MEMORY_DIM=512
ENV TTT_VARIANT=mlp
ENV LEARNING_RATE=0.01

# Persistent volume mount points
VOLUME ["/app/weights", "/app/checkpoints"]

# Expose MCP server port
EXPOSE 8765

# Default to shell for development
CMD ["/bin/bash"]
